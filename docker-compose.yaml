services:
  anki-sync-server:
    image: anki-sync-server
    build:
      context: .
      dockerfile: Dockerfile
      network: host
    environment:
      - SYNC_USER1=${SYNC_USER1:?Please set SYNC_USER1 in format user:pass}
      - SYNC_BASE=${SYNC_BASE:-/syncserver}
    volumes:
      - ${DATA_PATH:-./syncserver}:/syncserver

  mcp-flashcard-server:
    image: mcp-flashcard-server
    build:
      context: ./mcp-server
      dockerfile: Dockerfile
    environment:
      # Shared credentials with sync server
      - SYNC_USER1=${SYNC_USER1:?Please set SYNC_USER1 in format user:pass}
      - SYNC_BASE=${SYNC_BASE:-/syncserver}
      # MCP server specific
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:?Please set ANTHROPIC_API_KEY}
      - AUTO_GENERATE=${AUTO_GENERATE:-true}
      - MCP_PORT=${MCP_PORT:-8080}
    volumes:
      # Share the same data volume as sync server
      - ${DATA_PATH:-./syncserver}:/syncserver
    ports:
      - "${MCP_PORT:-8080}:8080"
    depends_on:
      - anki-sync-server
    stdin_open: true
    tty: true